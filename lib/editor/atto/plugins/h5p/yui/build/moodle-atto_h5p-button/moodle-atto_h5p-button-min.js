YUI.add("moodle-atto_h5p-button",function(e,t){var n={INPUTALT:"atto_h5p_altentry",INPUTSUBMIT:"atto_h5p_urlentrysubmit",INPUTHVPURL:"atto_h5p_url",URLWARNING:"atto_h5p_warning"},r={INPUTHVPURL:"."+n.INPUTHVPURL},i="atto_h5p",s='<form class="atto_form"><div class="mb-1"><label for="{{elementid}}_{{CSS.INPUTHVPURL}}">{{get_string "enterurl" component}}</label><div style="display:none" role="alert" class="alert alert-warning mb-1 {{CSS.URLWARNING}}">{{get_string "invalidh5purl" component}}</div><input class="form-control fullwidth {{CSS.INPUTHVPURL}}" type="url" id="{{elementid}}_{{CSS.INPUTHVPURL}}" size="32"/></div><button class="btn btn-secondary {{CSS.INPUTSUBMIT}}" type="submit">{{get_string "saveh5p" component}}</button></div></form>',o='<iframe id="h5pcontent" src="{{url}}/embed" width="100%" height="637" frameborder="0"allowfullscreen="{{allowfullscreen}}" allowmedia="{{allowmedia}}"></iframe><script src="'+M.cfg.wwwroot+'/lib/h5p/js/h5p-resizer.js" charset="UTF-8"></script>';e.namespace("M.atto_h5p").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_form:null,initializer:function(){this.addButton({icon:"e/insert_h5p",callback:this._displayDialogue,tags:"h5p",tagMatchRequiresAll:!1})},_displayDialogue:function(){this._currentSelection=this.get("host").getSelection();if(this._currentSelection===!1)return;var e=this.getDialogue({headerContent:M.util.get_string("h5pproperties",i),width:"auto",focusAfterHide:!0,focusOnShowSelector:r.INPUTHVPURL});e.set("bodyContent",this._getDialogueContent()).show()},_getDialogueContent:function(){var t=e.Handlebars.compile(s),r=e.Node.create(t({elementid:this.get("host").get("elementid"),CSS:n,component:i}));return this._form=r,this._form.one("."+n.INPUTSUBMIT).on("click",this._setHvp,this),r},_setHvp:function(t){var r=this._form,i=r.one("."+n.INPUTHVPURL).get("value"),s,u=this.get("host");t.preventDefault();if(this._updateWarning())return;u.focus();if(i!==""){u.setSelection(this._currentSelection);var a=e.Handlebars.compile(o);s=a({url:i,allowfullscreen:"allowfullscreen",allowmedia:"geolocation *; microphone *; camera *; midi *; encrypted-media *"}),this.get("host").insertContentAtFocusPoint(s),this.markUpdated()}this.getDialogue({focusAfterHide:null}).hide()},_validURL:function(e){var t=new RegExp("^https:\\/\\/([^.\\s]+\\.+h5p\\.com\\/content|h5p\\.org\\/h5p\\/embed)\\/\\d+");return!!t.test(e)},_updateWarning:function(){var e=this._form,t=!0,r=e.one("."+n.INPUTHVPURL).get("value");return this._validURL(r)?(e.one("."+n.URLWARNING).setStyle("display","none"),t=!1):(e.one("."+n.URLWARNING).setStyle("display","block"),t=!0),t}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
